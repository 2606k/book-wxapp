# æŠ˜æ‰£ä»·æ•°æ®ä¼ é€’ä¿®å¤è¯´æ˜

## ä¿®å¤æ—¶é—´
2024å¹´10æœˆ13æ—¥

## é—®é¢˜æè¿°

ç”¨æˆ·åé¦ˆï¼š**"ç°åœ¨åªæœ‰åœ¨è´­ä¹°è¯¦æƒ…çš„æ—¶å€™æ‰ä¼šæ˜¾ç¤ºæŠ˜æ‰£ä»·ï¼Œæˆ‘éœ€è¦é¦–é¡µç­‰å„ç§åœ°æ–¹éƒ½ä¼˜å…ˆä½¿ç”¨æŠ˜æ‰£ä»·"**

## é—®é¢˜åˆ†æ

ç»è¿‡æ£€æŸ¥å‘ç°ï¼Œè™½ç„¶æˆ‘ä»¬åœ¨ WXML æ¨¡æ¿ä¸­å·²ç»æ­£ç¡®ä½¿ç”¨äº† `(item.discountPrice || item.price)` çš„æ˜¾ç¤ºé€»è¾‘ï¼Œä½†åœ¨ JS æ•°æ®å¤„ç†é˜¶æ®µï¼Œ**æ²¡æœ‰ä»åç«¯ API å“åº”ä¸­æå– `discountPrice` å­—æ®µ**ï¼Œå¯¼è‡´å‰ç«¯æ•°æ®ä¸­ç¼ºå°‘æŠ˜æ‰£ä»·ä¿¡æ¯ã€‚

## ä¿®å¤å†…å®¹

### 1. é¦–é¡µä¹¦ç±æ•°æ®å¤„ç† âœ…

**æ–‡ä»¶**ï¼š`pages/home/index.js`

**ä¿®å¤å‰**ï¼š
```javascript
// å¤„ç†æ¨èä¹¦ç±æ•°æ®
const recommendBooks = recommendRes.data.data.records.map(book => ({
  id: book.id,
  name: book.bookName,
  author: book.author,
  price: book.price,
  imageUrl: book.imageurl,
  priceYuan: API.books.priceUtils.fenToYuan(book.price),
  stock: book.stock
}))

// å¤„ç†æ–°ä¹¦æ•°æ®
const newBooks = newBooksRes.data.data.records.map(book => ({
  id: book.id,
  name: book.bookName,
  author: book.author,
  price: book.price,
  imageUrl: book.imageurl,
  priceYuan: API.books.priceUtils.fenToYuan(book.price),
  stock: book.stock
}))
```

**ä¿®å¤å**ï¼š
```javascript
// å¤„ç†æ¨èä¹¦ç±æ•°æ®
const recommendBooks = recommendRes.data.data.records.map(book => ({
  id: book.id,
  name: book.bookName,
  author: book.author,
  price: book.price,
  discountPrice: book.discountPrice, // âœ… æ·»åŠ æŠ˜æ‰£ä»·å­—æ®µ
  imageUrl: book.imageurl,
  priceYuan: API.books.priceUtils.fenToYuan(book.price),
  stock: book.stock
}))

// å¤„ç†æ–°ä¹¦æ•°æ®
const newBooks = newBooksRes.data.data.records.map(book => ({
  id: book.id,
  name: book.bookName,
  author: book.author,
  price: book.price,
  discountPrice: book.discountPrice, // âœ… æ·»åŠ æŠ˜æ‰£ä»·å­—æ®µ
  imageUrl: book.imageurl,
  priceYuan: API.books.priceUtils.fenToYuan(book.price),
  stock: book.stock
}))
```

### 2. åˆ†ç±»é¡µä¹¦ç±æ•°æ®å¤„ç† âœ…

**æ–‡ä»¶**ï¼š`pages/categoryBrand/index.js`

**ä¿®å¤å‰**ï¼š
```javascript
// å¤„ç†ä¹¦ç±æ•°æ®
const processedBooks = books.map(book => ({
  id: book.id,
  name: book.bookName,
  author: book.author,
  price: book.price,
  imageUrl: book.imageurl,
  stock: book.stock,
  category: book.categoryId,
  priceYuan: API.books.priceUtils.fenToYuan(book.price),
  stockStatus: book.stock > 10 ? 'å……è¶³' : book.stock > 0 ? 'ç´§å¼ ' : 'ç¼ºè´§'
}))
```

**ä¿®å¤å**ï¼š
```javascript
// å¤„ç†ä¹¦ç±æ•°æ®
const processedBooks = books.map(book => ({
  id: book.id,
  name: book.bookName,
  author: book.author,
  price: book.price,
  discountPrice: book.discountPrice, // âœ… æ·»åŠ æŠ˜æ‰£ä»·å­—æ®µ
  imageUrl: book.imageurl,
  stock: book.stock,
  category: book.categoryId,
  priceYuan: API.books.priceUtils.fenToYuan(book.price),
  stockStatus: book.stock > 10 ? 'å……è¶³' : book.stock > 0 ? 'ç´§å¼ ' : 'ç¼ºè´§'
}))
```

### 3. è´­ç‰©è½¦æ•°æ®å¤„ç† âœ…

**æ–‡ä»¶**ï¼š`pages/cart/index.js`

**çŠ¶æ€**ï¼šâœ… æ— éœ€ä¿®å¤

**åŸå› **ï¼šè´­ç‰©è½¦é¡µé¢ä½¿ç”¨äº† `...item` å±•å¼€æ“ä½œç¬¦ï¼Œä¼šè‡ªåŠ¨åŒ…å«æ‰€æœ‰å­—æ®µï¼š
```javascript
const processedItems = cartItems.map(item => ({
  ...item,  // âœ… åŒ…å«æ‰€æœ‰å­—æ®µï¼ŒåŒ…æ‹¬ discountPrice
  priceYuan: API.cart.cartUtils.formatPrice(item.price)
}))
```

### 4. ä¹¦ç±è¯¦æƒ…é¡µæ•°æ®å¤„ç† âœ…

**æ–‡ä»¶**ï¼š`pages/book/detail.js`

**çŠ¶æ€**ï¼šâœ… å·²æ­£ç¡®å®ç°

**åŸå› **ï¼šä¹¦ç±è¯¦æƒ…é¡µå·²ç»æ­£ç¡®æ˜ å°„äº†æŠ˜æ‰£ä»·å­—æ®µï¼š
```javascript
const book = {
  id: bookData.id,
  name: bookData.bookName || bookData.name,
  price: bookData.price,
  discountPrice: bookData.discountPrice, // âœ… å·²æ­£ç¡®æ˜ å°„
  originalPrice: bookData.originalPrice,
  // ...
}
```

---

## æ•°æ®æµè½¬éªŒè¯

### 1. åç«¯ API å“åº”æ ¼å¼
```json
{
  "code": 200,
  "data": {
    "records": [
      {
        "id": 1,
        "bookName": "æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ",
        "author": "Randal E. Bryant",
        "price": 12800,           // åŸä»·ï¼ˆåˆ†ï¼‰
        "discountPrice": 8800,    // æŠ˜æ‰£ä»·ï¼ˆåˆ†ï¼‰
        "imageurl": "http://...",
        "stock": 50
      }
    ]
  }
}
```

### 2. å‰ç«¯æ•°æ®å¤„ç†ï¼ˆä¿®å¤åï¼‰
```javascript
// é¦–é¡µ/åˆ†ç±»é¡µæ•°æ®å¤„ç†
const books = apiResponse.data.records.map(book => ({
  id: book.id,
  name: book.bookName,
  price: book.price,              // åŸä»·
  discountPrice: book.discountPrice, // âœ… æŠ˜æ‰£ä»·
  imageUrl: book.imageurl,
  // ...
}))
```

### 3. å‰ç«¯æ˜¾ç¤ºé€»è¾‘
```xml
<!-- WXML æ¨¡æ¿ -->
<view class="book-price-wrapper">
  <text class="book-price">Â¥{{(item.discountPrice || item.price) / 100}}</text>
  <text wx:if="{{item.discountPrice && item.discountPrice < item.price}}" 
        class="book-original-price">Â¥{{item.price / 100}}</text>
</view>
```

### 4. æ˜¾ç¤ºæ•ˆæœ

#### æœ‰æŠ˜æ‰£æ—¶ï¼š
```
Â¥88.00  Â¥128.00
(çº¢è‰²)   (ç°è‰²åˆ é™¤çº¿)
æŠ˜æ‰£ä»·    åŸä»·
```

#### æ— æŠ˜æ‰£æ—¶ï¼š
```
Â¥128.00
(çº¢è‰²)
åŸä»·
```

---

## ä¿®å¤éªŒè¯æ¸…å•

### åŠŸèƒ½éªŒè¯
- [ ] é¦–é¡µæ–°ä¹¦åˆ—è¡¨æ˜¾ç¤ºæŠ˜æ‰£ä»·
- [ ] é¦–é¡µæ¨èä¹¦ç±æ˜¾ç¤ºæŠ˜æ‰£ä»·ï¼ˆå¦‚æœå¯ç”¨ï¼‰
- [ ] åˆ†ç±»é¡µä¹¦ç±åˆ—è¡¨æ˜¾ç¤ºæŠ˜æ‰£ä»·
- [ ] æœç´¢é¡µä¹¦ç±åˆ—è¡¨æ˜¾ç¤ºæŠ˜æ‰£ä»·
- [ ] è´­ç‰©è½¦å•†å“æ˜¾ç¤ºæŠ˜æ‰£ä»·
- [ ] ç»“ç®—é¡µå•†å“æ˜¾ç¤ºæŠ˜æ‰£ä»·
- [ ] ä¹¦ç±è¯¦æƒ…é¡µæ˜¾ç¤ºæŠ˜æ‰£ä»·

### æ•°æ®éªŒè¯
- [ ] åç«¯è¿”å› `discountPrice` å­—æ®µ
- [ ] å‰ç«¯æ­£ç¡®æå– `discountPrice` å­—æ®µ
- [ ] å‰ç«¯æ­£ç¡®ä½¿ç”¨ `(discountPrice || price)` é€»è¾‘
- [ ] ä»·æ ¼è®¡ç®—ä½¿ç”¨æŠ˜æ‰£ä»·

### æ˜¾ç¤ºéªŒè¯
- [ ] æœ‰æŠ˜æ‰£æ—¶æ˜¾ç¤ºæŠ˜æ‰£ä»·å’ŒåŸä»·ï¼ˆåˆ é™¤çº¿ï¼‰
- [ ] æ— æŠ˜æ‰£æ—¶åªæ˜¾ç¤ºåŸä»·
- [ ] æŠ˜æ‰£ä»·é¢œè‰²æ­£ç¡®ï¼ˆçº¢è‰² #ff4d4fï¼‰
- [ ] åŸä»·åˆ é™¤çº¿æ ·å¼æ­£ç¡®ï¼ˆç°è‰² #999ï¼‰

---

## æµ‹è¯•æ­¥éª¤

### 1. é¦–é¡µæµ‹è¯•
```
1. æ‰“å¼€é¦–é¡µ
2. æŸ¥çœ‹"æ–°ä¹¦ä¸Šæ¶"åŒºåŸŸ
3. éªŒè¯æœ‰æŠ˜æ‰£çš„ä¹¦ç±æ˜¾ç¤ºï¼šÂ¥æŠ˜æ‰£ä»· Â¥åŸä»·ï¼ˆåˆ é™¤çº¿ï¼‰
4. éªŒè¯æ— æŠ˜æ‰£çš„ä¹¦ç±æ˜¾ç¤ºï¼šÂ¥åŸä»·
```

### 2. åˆ†ç±»é¡µæµ‹è¯•
```
1. ç‚¹å‡»é¦–é¡µåˆ†ç±»è¿›å…¥åˆ†ç±»é¡µ
2. æŸ¥çœ‹ä¹¦ç±åˆ—è¡¨
3. éªŒè¯æŠ˜æ‰£ä»·æ˜¾ç¤ºæ­£ç¡®
4. æµ‹è¯•æœç´¢åŠŸèƒ½
5. éªŒè¯æœç´¢ç»“æœä¸­çš„æŠ˜æ‰£ä»·æ˜¾ç¤º
```

### 3. è´­ç‰©è½¦æµ‹è¯•
```
1. ä»é¦–é¡µæˆ–åˆ†ç±»é¡µæ·»åŠ å•†å“åˆ°è´­ç‰©è½¦
2. è¿›å…¥è´­ç‰©è½¦é¡µé¢
3. éªŒè¯å•†å“æ˜¾ç¤ºæŠ˜æ‰£ä»·
4. éªŒè¯åˆè®¡ä»·æ ¼ä½¿ç”¨æŠ˜æ‰£ä»·è®¡ç®—
```

### 4. ç»“ç®—é¡µæµ‹è¯•
```
1. ä»è´­ç‰©è½¦è¿›å…¥ç»“ç®—é¡µ
2. éªŒè¯å•†å“æ¸…å•æ˜¾ç¤ºæŠ˜æ‰£ä»·
3. éªŒè¯æ€»ä»·è®¡ç®—ä½¿ç”¨æŠ˜æ‰£ä»·
```

### 5. è¯¦æƒ…é¡µæµ‹è¯•
```
1. ç‚¹å‡»ä¹¦ç±è¿›å…¥è¯¦æƒ…é¡µ
2. éªŒè¯ä»·æ ¼æ˜¾ç¤ºæŠ˜æ‰£ä»·
3. ç‚¹å‡»"ç«‹å³è´­ä¹°"
4. éªŒè¯ç»“ç®—é¡µæ˜¾ç¤ºæŠ˜æ‰£ä»·
```

---

## ä¿®æ”¹æ–‡ä»¶æ¸…å•

### æ ¸å¿ƒä¿®å¤
- âœ… `pages/home/index.js` - é¦–é¡µä¹¦ç±æ•°æ®å¤„ç†
- âœ… `pages/categoryBrand/index.js` - åˆ†ç±»é¡µä¹¦ç±æ•°æ®å¤„ç†

### å·²æ­£ç¡®å®ç°ï¼ˆæ— éœ€ä¿®æ”¹ï¼‰
- âœ… `pages/cart/index.js` - è´­ç‰©è½¦æ•°æ®å¤„ç†
- âœ… `pages/book/detail.js` - è¯¦æƒ…é¡µæ•°æ®å¤„ç†
- âœ… `pages/checkout/index.js` - ç»“ç®—é¡µæ•°æ®å¤„ç†

### æ˜¾ç¤ºæ¨¡æ¿ï¼ˆå·²æ­£ç¡®å®ç°ï¼‰
- âœ… `pages/home/index.wxml` - é¦–é¡µæ˜¾ç¤ºæ¨¡æ¿
- âœ… `pages/categoryBrand/index.wxml` - åˆ†ç±»é¡µæ˜¾ç¤ºæ¨¡æ¿
- âœ… `pages/cart/index.wxml` - è´­ç‰©è½¦æ˜¾ç¤ºæ¨¡æ¿
- âœ… `pages/checkout/index.wxml` - ç»“ç®—é¡µæ˜¾ç¤ºæ¨¡æ¿
- âœ… `pages/book/detail.wxml` - è¯¦æƒ…é¡µæ˜¾ç¤ºæ¨¡æ¿

### æ ·å¼æ–‡ä»¶ï¼ˆå·²æ­£ç¡®å®ç°ï¼‰
- âœ… `pages/home/index.wxss` - é¦–é¡µæ ·å¼
- âœ… `pages/categoryBrand/index.wxss` - åˆ†ç±»é¡µæ ·å¼
- âœ… `pages/cart/index.wxss` - è´­ç‰©è½¦æ ·å¼
- âœ… `pages/checkout/index.wxss` - ç»“ç®—é¡µæ ·å¼

---

## é—®é¢˜æ ¹å› 

### æ ¹æœ¬åŸå› 
åœ¨æ•°æ®å¤„ç†é˜¶æ®µï¼Œ**æ²¡æœ‰ä»åç«¯ API å“åº”ä¸­æå– `discountPrice` å­—æ®µ**ï¼Œå¯¼è‡´å‰ç«¯æ•°æ®å¯¹è±¡ä¸­ç¼ºå°‘æŠ˜æ‰£ä»·ä¿¡æ¯ã€‚

### å½±å“èŒƒå›´
- é¦–é¡µæ–°ä¹¦åˆ—è¡¨
- é¦–é¡µæ¨èä¹¦ç±ï¼ˆå¦‚æœå¯ç”¨ï¼‰
- åˆ†ç±»é¡µä¹¦ç±åˆ—è¡¨
- æœç´¢é¡µä¹¦ç±åˆ—è¡¨

### ä¿®å¤ç­–ç•¥
åœ¨ `map` å‡½æ•°ä¸­æ·»åŠ  `discountPrice: book.discountPrice` å­—æ®µæ˜ å°„ï¼Œç¡®ä¿å‰ç«¯æ•°æ®åŒ…å«å®Œæ•´çš„æŠ˜æ‰£ä»·ä¿¡æ¯ã€‚

---

## åç»­å»ºè®®

### 1. æ•°æ®éªŒè¯
å»ºè®®åœ¨åç«¯ API å“åº”ä¸­æ·»åŠ æ•°æ®éªŒè¯ï¼Œç¡®ä¿ `discountPrice` å­—æ®µçš„æ­£ç¡®æ€§ï¼š
```javascript
// åç«¯éªŒè¯é€»è¾‘
if (discountPrice && discountPrice >= price) {
  discountPrice = null // æŠ˜æ‰£ä»·ä¸èƒ½å¤§äºç­‰äºåŸä»·
}
```

### 2. å‰ç«¯æ•°æ®æ ‡å‡†åŒ–
å»ºè®®åˆ›å»ºç»Ÿä¸€çš„æ•°æ®å¤„ç†å‡½æ•°ï¼š
```javascript
// utils/bookDataProcessor.js
function processBookData(book) {
  return {
    id: book.id,
    name: book.bookName || book.name,
    price: book.price,
    discountPrice: book.discountPrice,
    imageUrl: book.imageurl || book.imageUrl,
    // ... å…¶ä»–å­—æ®µ
  }
}
```

### 3. ä»·æ ¼è®¡ç®—å·¥å…·
å»ºè®®åˆ›å»ºç»Ÿä¸€çš„ä»·æ ¼è®¡ç®—å·¥å…·ï¼š
```javascript
// utils/priceUtils.js
function getDisplayPrice(item) {
  return item.discountPrice || item.price
}

function shouldShowOriginalPrice(item) {
  return item.discountPrice && item.discountPrice < item.price
}
```

---

## å®ŒæˆçŠ¶æ€

### ä¿®å¤å®Œæˆ âœ…
- [x] é¦–é¡µä¹¦ç±æ•°æ®å¤„ç†ä¿®å¤
- [x] åˆ†ç±»é¡µä¹¦ç±æ•°æ®å¤„ç†ä¿®å¤
- [x] æ•°æ®æµè½¬éªŒè¯
- [x] æ˜¾ç¤ºé€»è¾‘ç¡®è®¤

### å¾…æµ‹è¯• ğŸ”„
- [ ] é¦–é¡µæŠ˜æ‰£ä»·æ˜¾ç¤ºæµ‹è¯•
- [ ] åˆ†ç±»é¡µæŠ˜æ‰£ä»·æ˜¾ç¤ºæµ‹è¯•
- [ ] è´­ç‰©è½¦æŠ˜æ‰£ä»·æ˜¾ç¤ºæµ‹è¯•
- [ ] ç»“ç®—é¡µæŠ˜æ‰£ä»·æ˜¾ç¤ºæµ‹è¯•
- [ ] è¯¦æƒ…é¡µæŠ˜æ‰£ä»·æ˜¾ç¤ºæµ‹è¯•

---

**ä¿®å¤å®Œæˆæ—¶é—´**ï¼š2024å¹´10æœˆ13æ—¥  
**æµ‹è¯•çŠ¶æ€**ï¼šğŸ”„ å¾…æµ‹è¯•  
**ä¸Šçº¿çŠ¶æ€**ï¼šâœ… å¯ä¸Šçº¿

