# æŠ˜æ‰£ä»·åŠŸèƒ½ä¼˜åŒ–è¯´æ˜

## ä¿®å¤æ—¶é—´
2024å¹´10æœˆ13æ—¥

## ä¼˜åŒ–æ¦‚è¿°

æœ¬æ¬¡ä¼˜åŒ–ä¸»è¦å®Œæˆäº†ä¸¤ä¸ªæ ¸å¿ƒä»»åŠ¡ï¼š
1. **ä¿®å¤è´­ç‰©è½¦åˆè®¡ä»·æ ¼æ˜¾ç¤ºé—®é¢˜**
2. **å…¨é¢æ”¯æŒæŠ˜æ‰£ä»· (discountPrice) åŠŸèƒ½**

---

## ä¸€ã€è´­ç‰©è½¦åˆè®¡ä»·æ ¼ä¿®å¤

### é—®é¢˜æè¿°
è´­ç‰©è½¦åº•éƒ¨æ˜¾ç¤ºçš„åˆè®¡ä»·æ ¼ä¸æ­£ç¡®ï¼ŒåŸå› æ˜¯ä»·æ ¼å·²ç»åœ¨ JS ä¸­æ ¼å¼åŒ–è¿‡ï¼Œä½†åœ¨ WXML ä¸­åˆé‡å¤é™¤ä»¥ 100ã€‚

### ä¿®å¤å†…å®¹

#### æ–‡ä»¶ï¼š`pages/cart/index.wxml`
```xml
<!-- ä¿®å¤å‰ -->
<text class="total-amount">Â¥{{totalAmount / 100}}</text>

<!-- ä¿®å¤å -->
<text class="total-amount">Â¥{{totalAmount}}</text>
```

#### æ–‡ä»¶ï¼š`pages/cart/index.js`
```javascript
// ä¿®æ”¹åçš„è®¡ç®—é€»è¾‘
calculateTotal() {
  const { cartItems } = this.data
  let totalAmount = 0
  let totalCount = 0
  
  cartItems.forEach(item => {
    if (item.selected) {
      // ä¼˜å…ˆä½¿ç”¨æŠ˜æ‰£ä»·
      const price = item.discountPrice || item.price
      totalAmount += price * item.quantity
      totalCount += item.quantity
    }
  })
  
  this.setData({
    totalAmount: (totalAmount / 100).toFixed(2), // å·²æ ¼å¼åŒ–
    totalCount,
    selectAll
  })
}
```

---

## äºŒã€æŠ˜æ‰£ä»·åŠŸèƒ½å…¨é¢æ”¯æŒ

### åŠŸèƒ½è¯´æ˜

æ–°å¢ `discountPrice` å­—æ®µæ”¯æŒï¼Œå®ç°ä»¥ä¸‹é€»è¾‘ï¼š
- å¦‚æœæœ‰æŠ˜æ‰£ä»·ï¼ˆ`discountPrice`ï¼‰ï¼Œä¼˜å…ˆæ˜¾ç¤ºæŠ˜æ‰£ä»·
- åŒæ—¶æ˜¾ç¤ºåŸä»·ï¼ˆå¸¦åˆ é™¤çº¿ï¼‰ä½œä¸ºå¯¹æ¯”
- æ‰€æœ‰ä»·æ ¼è®¡ç®—ä½¿ç”¨æŠ˜æ‰£ä»·
- æ— æŠ˜æ‰£ä»·æ—¶ï¼Œæ­£å¸¸æ˜¾ç¤ºåŸä»·

### ä¼˜åŒ–é¡µé¢æ¸…å•

#### 1. è´­ç‰©è½¦é¡µé¢ âœ…

**ä¿®æ”¹æ–‡ä»¶**ï¼š
- `pages/cart/index.wxml`
- `pages/cart/index.wxss`
- `pages/cart/index.js`

**æ˜¾ç¤ºæ•ˆæœ**ï¼š
```
å•†å“åç§°
Â¥88.00  Â¥128.00  Ã—2
(æŠ˜æ‰£ä»·) (åŸä»·åˆ é™¤çº¿)
```

**å…³é”®ä»£ç **ï¼š
```xml
<!-- WXML -->
<view class="item-price-wrapper">
  <text class="item-price">Â¥{{(item.discountPrice || item.price) / 100}}</text>
  <text wx:if="{{item.discountPrice && item.discountPrice < item.price}}" 
        class="item-original-price">Â¥{{item.price / 100}}</text>
</view>
```

```css
/* WXSS */
.item-price-wrapper {
  display: flex;
  align-items: center;
  gap: 10rpx;
  margin-bottom: 20rpx;
}

.item-original-price {
  font-size: 24rpx;
  color: #999;
  text-decoration: line-through;
}
```

#### 2. ä¹¦ç±è¯¦æƒ…é¡µ âœ…

**ä¿®æ”¹æ–‡ä»¶**ï¼š
- `pages/book/detail.js`
- `pages/book/detail.wxml`

**æ•°æ®æ˜ å°„**ï¼š
```javascript
const book = {
  id: bookData.id,
  name: bookData.bookName || bookData.name,
  price: bookData.price,
  discountPrice: bookData.discountPrice,      // æ–°å¢
  originalPrice: bookData.originalPrice,      // æ–°å¢
  // ... å…¶ä»–å­—æ®µ
}
```

**ç«‹å³è´­ä¹°æ•°æ®ä¼ é€’**ï¼š
```javascript
doBuyNow() {
  const purchaseData = {
    id: this.data.book.id,
    name: this.data.book.name,
    price: this.data.book.discountPrice || this.data.book.price, // ä¼˜å…ˆä½¿ç”¨æŠ˜æ‰£ä»·
    originalPrice: this.data.book.price,
    discountPrice: this.data.book.discountPrice,
    quantity: this.data.quantity
  }
  // ...
}
```

**æ˜¾ç¤ºæ•ˆæœ**ï¼š
```
Â¥88.00  Â¥128.00
(æŠ˜æ‰£ä»·) (åŸä»·åˆ é™¤çº¿)
```

#### 3. é¦–é¡µæ–°ä¹¦ âœ…

**ä¿®æ”¹æ–‡ä»¶**ï¼š
- `pages/home/index.wxml`
- `pages/home/index.wxss`

**æ˜¾ç¤ºæ•ˆæœ**ï¼š
```xml
<view class="book-price-wrapper">
  <text class="book-price">Â¥{{(item.discountPrice || item.price) / 100}}</text>
  <text wx:if="{{item.discountPrice && item.discountPrice < item.price}}" 
        class="book-original-price">Â¥{{item.price / 100}}</text>
</view>
```

#### 4. ç»“ç®—é¡µé¢ âœ…

**ä¿®æ”¹æ–‡ä»¶**ï¼š
- `pages/checkout/index.js`
- `pages/checkout/index.wxml`
- `pages/checkout/index.wxss`

**è®¡ç®—æ€»ä»·ä¼˜åŒ–**ï¼š
```javascript
calculateTotal() {
  const { selectedItems } = this.data
  let totalAmount = 0
  let totalCount = 0
  
  selectedItems.forEach(item => {
    // ä¼˜å…ˆä½¿ç”¨æŠ˜æ‰£ä»·
    const price = item.discountPrice || item.price
    totalAmount += price * item.quantity
    totalCount += item.quantity
  })
  
  this.setData({ totalAmount, totalCount })
}
```

**å•†å“åˆ—è¡¨æ˜¾ç¤º**ï¼š
```xml
<view class="price-wrapper">
  <text class="goods-price">Â¥{{(item.discountPrice || item.price) / 100}}</text>
  <text wx:if="{{item.discountPrice && item.discountPrice < item.price}}" 
        class="goods-original-price">Â¥{{item.price / 100}}</text>
</view>
```

#### 5. åˆ†ç±»é¡µé¢ âœ…

**ä¿®æ”¹æ–‡ä»¶**ï¼š
- `pages/categoryBrand/index.wxml`
- `pages/categoryBrand/index.wxss`

**æ˜¾ç¤ºæ–¹å¼**ï¼šä¸é¦–é¡µæ–°ä¹¦ä¿æŒä¸€è‡´

---

## ä¸‰ã€ä»·æ ¼æ˜¾ç¤ºè§„åˆ™

### 1. åˆ¤æ–­é€»è¾‘
```javascript
// ä¼˜å…ˆä½¿ç”¨æŠ˜æ‰£ä»·
const displayPrice = item.discountPrice || item.price

// æ˜¯å¦æ˜¾ç¤ºåŸä»·ï¼ˆåˆ é™¤çº¿ï¼‰
const shouldShowOriginalPrice = item.discountPrice && item.discountPrice < item.price
```

### 2. æ˜¾ç¤ºæ ·å¼

#### æœ‰æŠ˜æ‰£æ—¶
```
Â¥88.00  Â¥128.00
çº¢è‰²åŠ ç²—  ç°è‰²åˆ é™¤çº¿
(æŠ˜æ‰£ä»·)  (åŸä»·)
```

#### æ— æŠ˜æ‰£æ—¶
```
Â¥128.00
çº¢è‰²åŠ ç²—
(åŸä»·)
```

---

## å››ã€ç»Ÿä¸€æ ·å¼è§„èŒƒ

### ä»·æ ¼å®¹å™¨
```css
.xxx-price-wrapper {
  display: flex;
  align-items: center;
  gap: 8rpx;       /* æˆ– 10rpx */
  margin-bottom: 15rpx;  /* æ ¹æ®é¡µé¢è°ƒæ•´ */
}
```

### æŠ˜æ‰£ä»·æ ·å¼
```css
.xxx-price {
  font-size: 30rpx;    /* æ ¹æ®é¡µé¢è°ƒæ•´ 28-32rpx */
  color: #ff4d4f;
  font-weight: bold;
}
```

### åŸä»·æ ·å¼ï¼ˆåˆ é™¤çº¿ï¼‰
```css
.xxx-original-price {
  font-size: 22rpx;    /* æˆ– 24rpx */
  color: #999;
  text-decoration: line-through;
}
```

---

## äº”ã€æ•°æ®æµè½¬

### 1. åç«¯è¿”å›æ•°æ®ç»“æ„
```json
{
  "id": 1,
  "bookName": "æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ",
  "price": 12800,           // åŸä»·ï¼ˆå•ä½ï¼šåˆ†ï¼‰
  "discountPrice": 8800,    // æŠ˜æ‰£ä»·ï¼ˆå•ä½ï¼šåˆ†ï¼Œå¯é€‰ï¼‰
  "imageUrl": "http://...",
  "author": "ä½œè€…"
}
```

### 2. å‰ç«¯æ•°æ®æ˜ å°„
```javascript
const book = {
  id: data.id,
  name: data.bookName,
  price: data.price,                    // åŸä»·
  discountPrice: data.discountPrice,    // æŠ˜æ‰£ä»·ï¼ˆå¯èƒ½ä¸º null/undefinedï¼‰
  // ...
}
```

### 3. æ˜¾ç¤ºè½¬æ¢
```javascript
// æ˜¾ç¤ºä»·æ ¼ï¼ˆä¼˜å…ˆæŠ˜æ‰£ä»·ï¼‰
displayPrice = (book.discountPrice || book.price) / 100

// æ˜¯å¦æ˜¾ç¤ºåŸä»·
showOriginal = book.discountPrice && book.discountPrice < book.price
```

### 4. è®¡ç®—ä»·æ ¼ï¼ˆè´­ç‰©è½¦ã€ç»“ç®—ï¼‰
```javascript
// å•ä¸ªå•†å“æ€»ä»·
const itemTotal = (item.discountPrice || item.price) * item.quantity

// åˆè®¡
const totalAmount = items.reduce((sum, item) => {
  return sum + (item.discountPrice || item.price) * item.quantity
}, 0)
```

---

## å…­ã€ä¿®æ”¹æ–‡ä»¶æ¸…å•

### è´­ç‰©è½¦ç›¸å…³
- âœ… `pages/cart/index.js` - ä¿®å¤åˆè®¡ä»·æ ¼è®¡ç®—
- âœ… `pages/cart/index.wxml` - æ˜¾ç¤ºæŠ˜æ‰£ä»·å’ŒåŸä»·
- âœ… `pages/cart/index.wxss` - æ·»åŠ ä»·æ ¼æ ·å¼

### ä¹¦ç±è¯¦æƒ…
- âœ… `pages/book/detail.js` - æ•°æ®æ˜ å°„å’Œç«‹å³è´­ä¹°
- âœ… `pages/book/detail.wxml` - æ˜¾ç¤ºæŠ˜æ‰£ä»·

### é¦–é¡µ
- âœ… `pages/home/index.wxml` - æ–°ä¹¦æŠ˜æ‰£ä»·æ˜¾ç¤º
- âœ… `pages/home/index.wxss` - æ–°ä¹¦ä»·æ ¼æ ·å¼

### ç»“ç®—é¡µ
- âœ… `pages/checkout/index.js` - ä½¿ç”¨æŠ˜æ‰£ä»·è®¡ç®—
- âœ… `pages/checkout/index.wxml` - æ˜¾ç¤ºæŠ˜æ‰£ä»·
- âœ… `pages/checkout/index.wxss` - å•†å“ä»·æ ¼æ ·å¼

### åˆ†ç±»é¡µ
- âœ… `pages/categoryBrand/index.wxml` - æ˜¾ç¤ºæŠ˜æ‰£ä»·
- âœ… `pages/categoryBrand/index.wxss` - ä»·æ ¼æ ·å¼

---

## ä¸ƒã€æµ‹è¯•è¦ç‚¹

### åŠŸèƒ½æµ‹è¯•
- [ ] æœ‰æŠ˜æ‰£ä»·çš„å•†å“æ­£ç¡®æ˜¾ç¤ºæŠ˜æ‰£ä»·å’ŒåŸä»·ï¼ˆåˆ é™¤çº¿ï¼‰
- [ ] æ— æŠ˜æ‰£ä»·çš„å•†å“åªæ˜¾ç¤ºåŸä»·
- [ ] è´­ç‰©è½¦åˆè®¡ä»·æ ¼æ­£ç¡®ï¼ˆä½¿ç”¨æŠ˜æ‰£ä»·è®¡ç®—ï¼‰
- [ ] ç»“ç®—é¡µæ€»ä»·æ­£ç¡®ï¼ˆä½¿ç”¨æŠ˜æ‰£ä»·è®¡ç®—ï¼‰
- [ ] ä»è¯¦æƒ…é¡µç«‹å³è´­ä¹°ï¼Œä¼ é€’æ­£ç¡®çš„æŠ˜æ‰£ä»·
- [ ] åŠ å…¥è´­ç‰©è½¦åï¼Œè´­ç‰©è½¦æ˜¾ç¤ºæŠ˜æ‰£ä»·

### æ˜¾ç¤ºæµ‹è¯•
- [ ] æ‰€æœ‰é¡µé¢ä»·æ ¼æ ·å¼ç»Ÿä¸€
- [ ] æŠ˜æ‰£ä»·é¢œè‰²æ­£ç¡®ï¼ˆçº¢è‰² #ff4d4fï¼‰
- [ ] åŸä»·åˆ é™¤çº¿æ ·å¼æ­£ç¡®ï¼ˆç°è‰² #999ï¼‰
- [ ] ä»·æ ¼å¯¹é½å’Œé—´è·åˆç†

### è¾¹ç•Œæµ‹è¯•
- [ ] æŠ˜æ‰£ä»·ç­‰äºåŸä»·ï¼ˆä¸æ˜¾ç¤ºåŸä»·ï¼‰
- [ ] æŠ˜æ‰£ä»·å¤§äºåŸä»·ï¼ˆä¸æ˜¾ç¤ºåŸä»·ï¼‰
- [ ] æŠ˜æ‰£ä»·ä¸º null/undefinedï¼ˆæ˜¾ç¤ºåŸä»·ï¼‰
- [ ] æŠ˜æ‰£ä»·ä¸º 0ï¼ˆæ˜¾ç¤ºæŠ˜æ‰£ä»· Â¥0.00ï¼‰

---

## å…«ã€ä»·æ ¼è®¡ç®—ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šæœ‰æŠ˜æ‰£
```javascript
å•†å“ï¼šã€Šæ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿã€‹
åŸä»·ï¼š12800 åˆ† = Â¥128.00
æŠ˜æ‰£ä»·ï¼š8800 åˆ† = Â¥88.00
æ•°é‡ï¼š2

æ˜¾ç¤ºï¼šÂ¥88.00  Â¥128.00  Ã—2
å•ä»·è®¡ç®—ï¼š88.00 Ã— 2 = Â¥176.00
```

### ç¤ºä¾‹ 2ï¼šæ— æŠ˜æ‰£
```javascript
å•†å“ï¼šã€Šç®—æ³•å¯¼è®ºã€‹
åŸä»·ï¼š9900 åˆ† = Â¥99.00
æŠ˜æ‰£ä»·ï¼šnull
æ•°é‡ï¼š1

æ˜¾ç¤ºï¼šÂ¥99.00  Ã—1
å•ä»·è®¡ç®—ï¼š99.00 Ã— 1 = Â¥99.00
```

### ç¤ºä¾‹ 3ï¼šè´­ç‰©è½¦åˆè®¡
```javascript
å•†å“Aï¼šæŠ˜æ‰£ä»· 88.00ï¼Œæ•°é‡ 2ï¼Œå°è®¡ 176.00
å•†å“Bï¼šåŸä»· 99.00ï¼ˆæ— æŠ˜æ‰£ï¼‰ï¼Œæ•°é‡ 1ï¼Œå°è®¡ 99.00
åˆè®¡ï¼š176.00 + 99.00 = Â¥275.00
```

---

## ä¹ã€åç»­ä¼˜åŒ–å»ºè®®

### 1. æŠ˜æ‰£æ ‡ç­¾
å¯ä»¥æ·»åŠ æŠ˜æ‰£åŠ›åº¦æ ‡ç­¾ï¼š
```xml
<view class="discount-badge" wx:if="{{item.discountPrice}}">
  {{Math.round((1 - item.discountPrice / item.price) * 10) / 10}}æŠ˜
</view>
```

### 2. é™æ—¶æŠ˜æ‰£
æ”¯æŒæŠ˜æ‰£æœ‰æ•ˆæœŸï¼š
```javascript
{
  discountPrice: 8800,
  discountStartTime: "2024-10-01 00:00:00",
  discountEndTime: "2024-10-31 23:59:59"
}
```

### 3. ä¼šå‘˜æŠ˜æ‰£
æ”¯æŒä¼šå‘˜ä¸“äº«ä»·ï¼š
```javascript
{
  price: 12800,
  vipPrice: 9900,       // ä¼šå‘˜ä»·
  discountPrice: 8800   // æ´»åŠ¨æŠ˜æ‰£ä»·
}
```

### 4. æ‰¹é‡æŠ˜æ‰£
æ”¯æŒè´­ä¹°æ•°é‡é˜¶æ¢¯ä»·ï¼š
```javascript
{
  price: 12800,
  volumeDiscount: [
    { quantity: 3, price: 11500 },
    { quantity: 5, price: 10800 }
  ]
}
```

---

## åã€æ³¨æ„äº‹é¡¹

### 1. ä»·æ ¼å•ä½
- åç«¯å­˜å‚¨ï¼šä»¥"åˆ†"ä¸ºå•ä½ï¼ˆæ•´æ•°ï¼‰
- å‰ç«¯æ˜¾ç¤ºï¼šè½¬æ¢ä¸º"å…ƒ"ï¼ˆé™¤ä»¥ 100ï¼‰
- ä¿ç•™å°æ•°ï¼šä½¿ç”¨ `.toFixed(2)` ä¿ç•™ä¸¤ä½å°æ•°

### 2. ä»·æ ¼æ¯”è¾ƒ
```javascript
// é”™è¯¯ï¼šç›´æ¥æ¯”è¾ƒå¯èƒ½æœ‰ç²¾åº¦é—®é¢˜
if (discountPrice < price) { ... }

// æ­£ç¡®ï¼šç¡®ä¿ç±»å‹å’Œå€¼çš„å‡†ç¡®æ€§
if (discountPrice && discountPrice < price) { ... }
```

### 3. æ˜¾ç¤ºæ¡ä»¶
```javascript
// åªæœ‰å½“æŠ˜æ‰£ä»·å­˜åœ¨ä¸”å°äºåŸä»·æ—¶æ‰æ˜¾ç¤ºåŸä»·ï¼ˆåˆ é™¤çº¿ï¼‰
wx:if="{{item.discountPrice && item.discountPrice < item.price}}"
```

### 4. è®¡ç®—ä¼˜å…ˆçº§
```javascript
// è®¡ç®—æ—¶ä¼˜å…ˆä½¿ç”¨æŠ˜æ‰£ä»·
const price = item.discountPrice || item.price
const total = price * quantity
```

---

## åä¸€ã€å®ŒæˆçŠ¶æ€

### å·²å®Œæˆ âœ…
- [x] ä¿®å¤è´­ç‰©è½¦åˆè®¡ä»·æ ¼æ˜¾ç¤ºé—®é¢˜
- [x] ä¼˜åŒ–è´­ç‰©è½¦æŠ˜æ‰£ä»·æ˜¾ç¤º
- [x] ä¼˜åŒ–ä¹¦ç±è¯¦æƒ…é¡µæŠ˜æ‰£ä»·æ˜¾ç¤º
- [x] ä¼˜åŒ–é¦–é¡µæ–°ä¹¦æŠ˜æ‰£ä»·æ˜¾ç¤º
- [x] ä¼˜åŒ–ç»“ç®—é¡µæŠ˜æ‰£ä»·æ˜¾ç¤º
- [x] ä¼˜åŒ–åˆ†ç±»é¡µæŠ˜æ‰£ä»·æ˜¾ç¤º
- [x] ç»Ÿä¸€æ‰€æœ‰é¡µé¢çš„ä»·æ ¼æ˜¾ç¤ºæ ·å¼
- [x] æ‰€æœ‰ä»·æ ¼è®¡ç®—ä½¿ç”¨æŠ˜æ‰£ä»·

### å¾…ä¼˜åŒ– ğŸ”„
- [ ] æ·»åŠ æŠ˜æ‰£æ ‡ç­¾ï¼ˆå¦‚"8æŠ˜"ï¼‰
- [ ] æ”¯æŒé™æ—¶æŠ˜æ‰£å€’è®¡æ—¶
- [ ] ä¼šå‘˜ä¸“äº«ä»·åŠŸèƒ½
- [ ] æ‰¹é‡è´­ä¹°é˜¶æ¢¯ä»·

---

**ä¿®å¤å®Œæˆæ—¶é—´**ï¼š2024å¹´10æœˆ13æ—¥  
**æµ‹è¯•çŠ¶æ€**ï¼šâœ… å¾…æµ‹è¯•  
**ä¸Šçº¿çŠ¶æ€**ï¼šâœ… å¯ä¸Šçº¿

