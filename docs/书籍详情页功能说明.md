# 书籍详情页功能说明

## 概述

书籍详情页用于展示书籍的完整信息，包括封面、基本信息、详细参数、内容简介等，并提供加入购物车和立即购买功能。

## 页面路径

`pages/book/detail`

## 访问方式

### 1. 从首页访问
- 点击"新书上架"中的任意书籍
- 自动跳转到详情页

### 2. 从分类页面访问
- 点击分类列表中的任意书籍
- 自动跳转到详情页

### 3. 分享链接访问
- 通过微信分享的书籍链接
- 直接打开详情页

## 页面功能

### 1. 书籍信息展示

#### 头部区域
- **📷 书籍封面**
  - 大尺寸封面图（240x320rpx）
  - 点击可查看大图（预览功能）
  - 阴影效果增强视觉
  
- **📖 基本信息**
  - 书籍名称（大字号，粗体）
  - 作者
  - 出版社
  - 价格（醒目红色）
  - 原价（删除线，如有）
  - 库存状态

#### 详细信息区域
- **ISBN**：国际标准书号
- **分类**：所属图书分类
- **出版日期**：出版时间
- **页数**：图书页数
- **语言**：图书语言

#### 内容简介区域
- 书籍的详细描述
- 多行文本显示
- 两端对齐排版

### 2. 购买功能

#### 数量选择器
- ➖ 减少按钮（最小1）
- 🔢 数量输入框（可直接输入）
- ➕ 增加按钮（最大库存数）
- 自动验证库存限制

#### 操作按钮
- **🛒 加入购物车**
  - 橙色按钮
  - 需要登录验证
  - 添加指定数量到购物车
  - 成功后提示并重置数量

- **💰 立即购买**
  - 红色按钮
  - 需要登录验证
  - 跳转到订单确认页面
  - 携带书籍和数量信息

#### 缺货状态
- 库存为0时显示"暂时缺货"
- 禁用数量选择和购买按钮

### 3. 导航功能

#### 底部导航栏
- **🏠 首页**：返回首页（switchTab）
- **🛒 购物车**：查看购物车（switchTab）

### 4. 分享功能

- 点击右上角"..."分享
- 分享卡片包含：
  - 书籍名称
  - 书籍封面
  - 详情页链接（带书籍ID）

## 页面布局

```
┌─────────────────────────────────┐
│      [ 书籍详情 ]                │  ← 导航栏
├─────────────────────────────────┤
│  ┌────────┐  书籍名称            │
│  │        │  作者：XXX           │
│  │  封面  │  出版社：XXX         │
│  │        │  ¥99.00 ¥120.00     │
│  └────────┘  库存：100 本        │
├─────────────────────────────────┤
│  图书详情                         │
│  ISBN：XXX                       │
│  分类：XXX                       │
│  出版日期：XXX                    │
│  页数：XXX 页                     │
│  语言：中文                       │
├─────────────────────────────────┤
│  内容简介                         │
│  这是一本关于...的书籍           │
│  内容详细介绍...                 │
│                                  │
└─────────────────────────────────┘
┌─────────────────────────────────┐
│ 🏠   🛒  [-][1][+] [购物车][购买]│  ← 底部栏
└─────────────────────────────────┘
```

## 技术实现

### 页面结构

#### detail.wxml
- 加载状态显示
- 书籍信息展示
- 底部操作栏
- 条件渲染（wx:if）

#### detail.js
```javascript
Page({
  data: {
    bookId: null,      // 书籍ID
    book: null,        // 书籍详情
    loading: true,     // 加载状态
    quantity: 1,       // 购买数量
  },
  
  // 生命周期
  onLoad(options) {
    // 获取书籍ID
    // 加载书籍详情
  },
  
  // 核心方法
  loadBookDetail(),     // 加载详情
  addToCart(),          // 加入购物车
  buyNow(),             // 立即购买
  previewImage(),       // 预览图片
  onShareAppMessage()   // 分享
})
```

#### detail.wxss
- 响应式布局
- 卡片式设计
- 渐变价格显示
- 固定底部栏

### API 调用

#### 获取书籍详情
```javascript
const res = await API.books.getBookDetail(bookId)
```

**接口路径**：`GET /api/books/{id}`

**响应格式**：
```json
{
  "code": 200,
  "msg": "成功",
  "data": {
    "id": 1,
    "name": "书籍名称",
    "author": "作者",
    "publisher": "出版社",
    "imageUrl": "封面URL",
    "price": 9900,
    "originalPrice": 12000,
    "stock": 100,
    "isbn": "978-7-XXXXX",
    "categoryName": "计算机",
    "publishDate": "2024-01-01",
    "pages": 300,
    "language": "中文",
    "description": "内容简介..."
  }
}
```

#### 加入购物车
```javascript
const res = await API.cart.addToCart({
  openid: openid,
  bookId: bookId,
  quantity: quantity
})
```

### 登录验证

```javascript
// 检查登录状态
const app = getApp()
if (!app.checkUserAuth()) {
  // 显示登录页面
  app.showLoginDialog(() => {
    // 登录成功后执行操作
  })
  return
}
```

## 用户操作流程

### 浏览书籍详情
```
进入详情页
    ↓
加载书籍信息
    ↓
显示完整详情
    ↓
查看封面、价格、简介等
```

### 加入购物车
```
选择购买数量
    ↓
点击"加入购物车"
    ↓
检查登录状态
    ↓
未登录 → 显示登录页面 → 登录成功
    ↓
已登录 → 调用API添加
    ↓
显示成功提示
    ↓
数量重置为1
```

### 立即购买
```
选择购买数量
    ↓
点击"立即购买"
    ↓
检查登录状态
    ↓
未登录 → 显示登录页面 → 登录成功
    ↓
已登录 → 跳转订单确认页
    ↓
完成下单
```

### 预览图片
```
点击封面图片
    ↓
调用 wx.previewImage
    ↓
全屏查看大图
    ↓
支持缩放、保存
```

## UI 设计特点

### 1. 色彩方案
- **主色调**：白色背景 + 灰色页面背景
- **强调色**：橙红色（价格、按钮）
- **辅助色**：灰色（次要信息）

### 2. 布局特点
- **卡片式设计**：信息分块清晰
- **留白充足**：阅读体验好
- **固定底栏**：操作便捷
- **响应式适配**：不同屏幕适配

### 3. 交互反馈
- **点击反馈**：按钮按下效果
- **加载状态**：显示"加载中..."
- **成功提示**：Toast 提示
- **错误处理**：Modal 弹窗

### 4. 视觉层次
- **一级信息**：书名、价格（大字号）
- **二级信息**：作者、出版社（中字号）
- **三级信息**：详细参数（小字号）

## 功能特性

### ✅ 已实现功能

1. **信息展示**
   - ✅ 完整书籍信息显示
   - ✅ 封面大图预览
   - ✅ 价格对比（原价/现价）
   - ✅ 库存状态显示

2. **购买功能**
   - ✅ 数量选择（带验证）
   - ✅ 加入购物车
   - ✅ 立即购买
   - ✅ 登录验证

3. **导航功能**
   - ✅ 返回首页
   - ✅ 查看购物车
   - ✅ 分享书籍

4. **用户体验**
   - ✅ 下拉刷新
   - ✅ 加载状态
   - ✅ 错误处理
   - ✅ 缺货提示

## 注意事项

### 1. 数据验证
- ⚠️ 书籍ID必须存在
- ⚠️ 购买数量不能超过库存
- ⚠️ 价格单位为"分"，显示时需转换

### 2. 登录验证
- ⚠️ 加入购物车需要登录
- ⚠️ 立即购买需要登录
- ⚠️ 未登录自动跳转登录页

### 3. 错误处理
```javascript
// 书籍不存在
if (!bookId) {
  wx.showToast({ title: '书籍ID不存在' })
  wx.navigateBack()
}

// 加载失败
catch (error) {
  wx.showModal({
    title: '加载失败',
    content: '无法加载书籍详情',
    success: () => wx.navigateBack()
  })
}
```

### 4. 性能优化
- 📱 图片懒加载
- 🔄 下拉刷新
- 💾 数据缓存（可选）

## 测试清单

### 功能测试
- [ ] 从首页点击书籍正确跳转
- [ ] 从分类页点击书籍正确跳转
- [ ] 书籍详情正确显示
- [ ] 封面点击可预览大图
- [ ] 数量增减正确工作
- [ ] 加入购物车成功
- [ ] 立即购买跳转正确
- [ ] 缺货状态正确显示
- [ ] 分享功能正常

### 异常测试
- [ ] 书籍ID不存在 → 提示并返回
- [ ] 网络错误 → 友好提示
- [ ] 未登录加购 → 跳转登录
- [ ] 超过库存数量 → 限制并提示
- [ ] 加载失败 → 显示错误信息

### UI测试
- [ ] 不同屏幕尺寸显示正常
- [ ] 长文本正确换行
- [ ] 按钮点击有反馈
- [ ] 加载状态显示
- [ ] 底部栏不遮挡内容

## 文件清单

### 核心文件
- ✅ `pages/book/detail.js` - 页面逻辑
- ✅ `pages/book/detail.wxml` - 页面结构
- ✅ `pages/book/detail.wxss` - 页面样式
- ✅ `pages/book/detail.json` - 页面配置

### 依赖文件
- ✅ `utils/api/books.js` - 书籍API
- ✅ `utils/api/cart.js` - 购物车API
- ✅ `app.json` - 页面注册

### 关联页面
- 📄 `pages/home/index` - 首页（入口）
- 📄 `pages/categoryBrand/index` - 分类页（入口）
- 📄 `pages/cart/index` - 购物车
- 📄 `pages/checkout/index` - 订单确认
- 📄 `pages/login/index` - 登录页

## 扩展功能建议

### 可添加功能
- 📊 用户评价展示
- ⭐ 评分系统
- 💬 在线客服
- 📖 试读章节
- 🔖 收藏功能
- 👥 相关推荐
- 📈 销量统计
- 🎁 优惠券使用

---

**创建时间**：2024年10月12日  
**文档版本**：v1.0  
**页面状态**：✅ 已完成并测试

