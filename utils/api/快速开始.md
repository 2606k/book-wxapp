# 快速开始指南

## 1. 引入 API 模块

在任何页面中引入 API：

```javascript
const API = require('../../utils/api/index.js')
```

## 2. 基础使用

### 获取书籍列表
```javascript
async loadBooks() {
  const res = await API.books.getBookList({
    page: 1,
    size: 10
  })
  
  if (res.data && res.data.code === 200) {
    const books = res.data.data.records
    this.setData({ books })
  }
}
```

### 添加到购物车
```javascript
async addToCart(bookId) {
  const app = getApp()
  const openid = app.globalData.openid
  
  const res = await API.cart.addToCart({
    openid: openid,
    bookId: bookId,
    quantity: 1
  })
  
  if (res.data && res.data.code === 200) {
    wx.showToast({ title: '添加成功', icon: 'success' })
  }
}
```

### 获取购物车列表
```javascript
async loadCart() {
  const app = getApp()
  const openid = app.globalData.openid
  
  const res = await API.cart.getCartList(openid)
  
  if (res.data && res.data.code === 200) {
    const cartItems = res.data.data
    // 计算总价
    const totalPrice = API.cart.cartUtils.calculateTotal(cartItems, true)
    
    this.setData({ 
      cartItems,
      totalPrice: API.cart.cartUtils.formatPrice(totalPrice)
    })
  }
}
```

### 获取订单列表
```javascript
async loadOrders() {
  const app = getApp()
  const openid = app.globalData.openid
  
  const res = await API.order.getUserOrders(openid, 1, 20)
  
  if (res.data && res.data.code === 200) {
    const orders = res.data.data.records.map(order => ({
      ...order,
      statusText: API.order.orderUtils.formatStatus(order.status),
      priceYuan: API.order.orderUtils.formatPrice(order.money)
    }))
    
    this.setData({ orders })
  }
}
```

## 3. 价格转换

```javascript
// 分转元（显示用）
const priceYuan = API.books.priceUtils.fenToYuan(9900)  // "99.00"

// 元转分（提交用）
const priceFen = API.books.priceUtils.yuanToFen(99)     // 9900
```

## 4. 完整页面示例

```javascript
// pages/bookList/index.js
const API = require('../../utils/api/index.js')

Page({
  data: {
    books: [],
    page: 1
  },

  onLoad() {
    this.loadBooks()
  },

  async loadBooks() {
    try {
      const res = await API.books.getBookList({
        page: this.data.page,
        size: 10,
        stockStatus: 'inStock'
      })

      if (res.data && res.data.code === 200) {
        const books = res.data.data.records.map(book => ({
          ...book,
          priceYuan: API.books.priceUtils.fenToYuan(book.price)
        }))

        this.setData({ books })
      }
    } catch (error) {
      console.error('加载失败:', error)
    }
  },

  async addToCart(e) {
    const { bookId } = e.currentTarget.dataset
    const app = getApp()
    const openid = app.globalData.openid

    const res = await API.cart.addToCart({
      openid: openid,
      bookId: bookId,
      quantity: 1
    })

    if (res.data && res.data.code === 200) {
      wx.showToast({ title: '添加成功', icon: 'success' })
    }
  }
})
```

## 5. 可用的 API

### 书籍管理
- `API.books.getBookList(params)` - 获取书籍列表
- `API.books.getBookDetail(id)` - 获取书籍详情
- `API.books.searchBooks(keyword)` - 搜索书籍
- `API.books.getBooksByCategory(categoryId)` - 按分类查询

### 购物车管理
- `API.cart.getCartList(openid)` - 获取购物车
- `API.cart.addToCart(data)` - 添加到购物车
- `API.cart.updateCartItem(cartId, quantity)` - 更新数量
- `API.cart.removeCartItem(cartId)` - 删除商品
- `API.cart.clearCart(openid)` - 清空购物车

### 订单管理
- `API.order.createOrder(data)` - 创建订单
- `API.order.getUserOrders(openid, page, size)` - 用户订单列表
- `API.order.applyRefund(orderId, reason)` - 申请退款
- `API.order.closeOrder(outTradeNo)` - 关闭订单

### 分类管理
- `API.categories.getCategoryList()` - 获取所有分类
- `API.categories.getEnabledCategories()` - 获取启用的分类

### 地址管理
- `API.address.getAddressList(openid)` - 获取地址列表
- `API.address.addAddress(data)` - 添加地址
- `API.address.updateAddress(data)` - 更新地址
- `API.address.deleteAddress(id)` - 删除地址
- `API.address.setDefaultAddress(id, openid)` - 设置默认地址

## 6. 常见问题

**Q: 价格应该使用什么单位？**  
A: 后端存储使用分，前端显示时转换为元。

**Q: 如何获取用户 openid？**  
A: `const openid = getApp().globalData.openid || wx.getStorageSync('openid')`

**Q: 接口调用失败怎么办？**  
A: 已经封装了统一错误处理，会自动显示提示。

## 7. 更多示例

查看 `utils/api/example.js` 获取更多完整示例代码。

